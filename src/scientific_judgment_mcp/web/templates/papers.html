<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Papers</title>
    <link rel="stylesheet" href="/static/app.css" />
</head>

<body>
    <header class="topbar">
        <div class="nav" aria-label="Primary">
            <a href="/">Home</a>
            <a href="/papers">Papers</a>
            <a href="/reviews">Reviews</a>
        </div>
        <div class="muted" style="font-size: 13px;">Browse</div>
    </header>

    <main class="container">
        <h1 class="page-title">Papers with reviews</h1>
        <p class="subtitle">Find prior reviews and publishability results without re-running.</p>

        <section class="card">
            {% if papers and papers|length > 0 %}
            <table class="table">
                <thead>
                    <tr>
                        <th>arXiv</th>
                        <th style="max-width: 520px;">Title</th>
                        <th>Reviews</th>
                        <th>Publishability</th>
                        <th>Latest</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in papers %}
                    <tr>
                        <td>
                            <a href="/papers/{{ p.paper_id }}"><code>{{ p.arxiv_id }}</code></a>
                        </td>
                        <td style="max-width: 520px;">{{ p.title }}</td>
                        <td><code>{{ p.review_count }}</code></td>
                        <td>
                            <div class="stack" style="margin-top: 2px;">
                                <div>
                                    <span class="badge {{ p.publishability_badge_class or 'mid' }}">{{
                                        p.publishability_label }}</span>
                                </div>

                                {% if p.publishability_finality == 'Interim' %}
                                <div class="muted">Needs <code>{{ p.remaining_reviews_to_final }}</code> more review(s)
                                    for Final adjudication.</div>
                                {% endif %}

                                <div class="muted">{{ p.publishability_summary or '—' }}</div>
                                <div><a href="/papers/{{ p.paper_id }}/publishability">View result</a></div>

                                <div>
                                    {% if p.can_request_more_reviews and p.max_additional_reviews > 0 %}
                                    <form method="post" action="/review" class="stack" style="margin-top: 6px;">
                                        <input type="hidden" name="arxiv_id_or_url" value="{{ p.arxiv_id }}" />
                                        <input type="hidden" name="persist_to_supabase" value="true" />
                                        <div class="muted" style="font-size: 13px;">Request more reviews</div>
                                        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                                            <select class="select" name="num_reviews">
                                                {% for n in range(1, p.max_additional_reviews + 1) %}
                                                <option value="{{ n }}">{{ n }}</option>
                                                {% endfor %}
                                            </select>
                                            <button class="btn btn-primary" type="submit">Run</button>
                                        </div>
                                    </form>
                                    {% else %}
                                    <div class="muted" style="font-size: 13px;">Review locked (Final). Re-run only if
                                        paper is updated.</div>
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                        <td>
                            {% if p.latest_review_id %}
                            <a href="/reviews/{{ p.latest_review_id }}"><code>{{ p.latest_review_id }}</code></a>
                            <div class="muted">{{ p.latest_review_created_at }}</div>
                            {% else %}
                            <span class="muted">—</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="muted">No papers found.</p>
            {% endif %}
        </section>
    </main>
</body>

</html>
