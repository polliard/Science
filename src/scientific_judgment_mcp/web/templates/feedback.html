<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Human feedback</title>
    <link rel="stylesheet" href="/static/app.css" />
</head>

<body>
    <header class="topbar">
        <div class="nav" aria-label="Primary">
            <a href="/">Home</a>
            <a href="/papers">Papers</a>
            <a href="/reviews">Reviews</a>
            <a href="/feedback">Feedback</a>
        </div>
        <div class="muted" style="font-size: 13px;">Phase 9</div>
    </header>

    <main class="container stack">
        <h1 class="page-title">Human feedback</h1>
        <p class="subtitle">Append-only critique, classification, and a forward-only change note.</p>

        {% if not supabase_configured %}
        <div class="callout">
            <strong class="warn">Supabase not configured</strong>
            <div class="muted" style="margin-top: 4px;">Configure <code>.env</code> and apply
                <code>supabase/schema.sql</code> in Supabase.
            </div>
        </div>
        {% endif %}

        <section class="card stack" aria-label="Submit critique">
            <h2 style="margin: 0;">Submit critique</h2>
            <form method="post" action="/feedback">
                <label class="label" for="review_id">Review ID</label>
                <input class="input" id="review_id" name="review_id" type="text" value="{{ review_id or '' }}"
                    required />

                <label class="label" for="critique_text">Critique</label>
                <textarea id="critique_text" name="critique_text" required></textarea>

                <p style="margin: 0;"><button class="btn btn-primary" type="submit">Submit</button></p>
            </form>
        </section>

        {% if submitted %}
        <section class="card" aria-label="Classification">
            <h2 style="margin: 0;">Classification</h2>
            <pre>{{ classification | tojson }}</pre>
        </section>

        <section class="card" aria-label="Forward-only change note">
            <h2 style="margin: 0;">Forward-only change note</h2>
            {% if change_note %}
            <pre>{{ change_note }}</pre>
            {% else %}
            <p class="error">Could not generate change note.</p>
            {% endif %}
        </section>

        <section class="card" aria-label="Storage result">
            <h2 style="margin: 0;">Storage result</h2>
            {% if stored %}
            <pre>{{ stored | tojson }}</pre>
            {% else %}
            <p class="error">Store failed:
                {{ store_error }}</p>
            {% endif %}
        </section>
        {% endif %}

        <section class="card" aria-label="Comparison">
            <h2 style="margin: 0;">Comparison</h2>
            {% if comparison %}
            <pre>{{ comparison | tojson }}</pre>
            {% else %}
            <p class="muted">No comparison available.</p>
            {% endif %}
        </section>
    </main>

</body>

</html>
