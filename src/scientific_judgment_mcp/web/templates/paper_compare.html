<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Compare reviews</title>
    <link rel="stylesheet" href="/static/app.css" />
</head>

<body>
    <header class="topbar">
        <div class="nav" aria-label="Primary">
            <a href="/">Home</a>
            <a href="/papers">Papers</a>
            <a href="/reviews">Reviews</a>
            <a href="/feedback">Feedback</a>
        </div>
        <div class="muted" style="font-size: 13px;">Phase 9</div>
    </header>

    <main class="container stack">
        <h1 class="page-title">Compare reviews</h1>
        <p class="subtitle">
            arXiv: <code>{{ paper.arxiv_id }}</code>
            · Paper ID: <code>{{ paper_id }}</code>
            · <a href="/papers/{{ paper_id }}">View paper</a>
        </p>
        <p style="margin: 0;">{{ paper.title }}</p>

        <div class="row">
            <section class="card" aria-label="Summary">
                <h2 style="margin: 0;">Summary</h2>
                <p class="muted">High level outcomes across independent runs.</p>
                <ul>
                    <li>Total reviews: <code>{{ reviews|length }}</code></li>
                    <li>
                        Decisions:
                        {% if decision_counts and decision_counts|length > 0 %}
                        {% for k, v in decision_counts.items() %}
                        <span class="pill"><code>{{ k }}</code>: <code>{{ v }}</code></span>
                        {% endfor %}
                        {% else %}
                        <span class="muted">—</span>
                        {% endif %}
                    </li>
                </ul>
            </section>

            <section class="card" aria-label="Consensus">
                <h2 style="margin: 0;">Consensus (dimensions)</h2>
                {% if dim_stats and dim_stats|length > 0 %}
                <table class="table">
                    <thead>
                        <tr>
                            <th>Dimension</th>
                            <th>Mean</th>
                            <th>Min</th>
                            <th>Max</th>
                            <th>Range</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for s in dim_stats %}
                        <tr>
                            <td><code>{{ s.key }}</code></td>
                            <td><code>{{ s.mean }}</code></td>
                            <td><code>{{ s.min }}</code></td>
                            <td><code>{{ s.max }}</code></td>
                            <td><code>{{ s.range }}</code></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="muted">No verdict dimensions found.</p>
                {% endif %}
            </section>
        </div>

        <section class="card" aria-label="Key disagreements">
            <h2 style="margin: 0;">Key disagreements</h2>
            {% if disagreements and disagreements|length > 0 %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Dimension</th>
                        <th>Low</th>
                        <th>High</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in disagreements %}
                    <tr>
                        <td><code>{{ d.key }}</code></td>
                        <td>
                            <code>{{ d.min }}</code>
                            <div class="muted">{% for rid in d.low_reviews %}<a
                                    href="/reviews/{{ rid }}"><code>{{ rid }}</code></a><br />{% endfor %}</div>
                        </td>
                        <td>
                            <code>{{ d.max }}</code>
                            <div class="muted">{% for rid in d.high_reviews %}<a
                                    href="/reviews/{{ rid }}"><code>{{ rid }}</code></a><br />{% endfor %}</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="muted">No major disagreements detected (range &lt; 2 on all dimensions).</p>
            {% endif %}
        </section>

        <section class="card" aria-label="Per-review contrasts">
            <h2 style="margin: 0;">Per-review contrasts</h2>
            {% if reviews and reviews|length > 0 %}
            {% for r in reviews %}
            <div class="callout" style="margin-top: 14px;">
                <h3 style="margin: 0 0 10px 0;">
                    <a href="/reviews/{{ r.review_id }}"><code>{{ r.review_id }}</code></a>
                    <span class="muted">· {{ r.created_at }}</span>
                </h3>
                <p style="margin: 0 0 10px 0;">
                    Publishability: <code>{{ (r.publishability or {}).decision }}</code>
                    {% if (r.publishability or {}).provisional %}
                    <span class="muted">(provisional)</span>
                    {% endif %}
                    {% if r.verdict_version %}
                    <span class="muted">· verdict v{{ r.verdict_version }}</span>
                    {% endif %}
                </p>

                <table class="table">
                    <tbody>
                        <tr>
                            <td><code>methodological_soundness</code></td>
                            <td><code>{{ (r.dimensions or {}).methodological_soundness }}</code></td>
                            <td><code>evidence_strength</code></td>
                            <td><code>{{ (r.dimensions or {}).evidence_strength }}</code></td>
                        </tr>
                        <tr>
                            <td><code>novelty_value</code></td>
                            <td><code>{{ (r.dimensions or {}).novelty_value }}</code></td>
                            <td><code>scientific_contribution</code></td>
                            <td><code>{{ (r.dimensions or {}).scientific_contribution }}</code></td>
                        </tr>
                        <tr>
                            <td><code>risk_of_overreach</code></td>
                            <td><code>{{ (r.dimensions or {}).risk_of_overreach }}</code></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>

                {% if r.evidence_audit %}
                <details style="margin-top: 10px;">
                    <summary>Evidence audit (PRISMA + quote grounding)</summary>
                    <p class="muted" style="margin: 0.5rem 0 0.75rem 0;">
                        paper_type: <code>{{ r.evidence_audit.paper_type }}</code>
                        · quote_pass_rate: <code>{{ r.evidence_audit.quote_pass_rate }}</code>
                        · grounded: <code>{{ r.evidence_audit.grounded }}</code>
                        · ungrounded: <code>{{ r.evidence_audit.ungrounded }}</code>
                    </p>
                    <p class="muted" style="margin: 0 0 0.75rem 0;">
                        PRISMA checklist: present=<code>{{ r.evidence_audit.prisma_present }}</code>
                        partial=<code>{{ r.evidence_audit.prisma_partial }}</code>
                        missing=<code>{{ r.evidence_audit.prisma_missing }}</code>
                        total=<code>{{ r.evidence_audit.prisma_total }}</code>
                    </p>
                </details>
                {% endif %}

                {% if r.rationale %}
                <details style="margin-top: 10px;">
                    <summary>Rationale</summary>
                    <pre>{{ r.rationale }}</pre>
                </details>
                {% endif %}

                {% if r.synthesis_preview %}
                <details style="margin-top: 10px;">
                    <summary>Synthesis preview</summary>
                    <pre>{{ r.synthesis_preview }}</pre>
                </details>
                {% endif %}

                {% if include_reviewers and r.reviewers and r.reviewers|length > 0 %}
                <details style="margin-top: 10px;">
                    <summary>Reviewer snippets (latest per agent)</summary>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Agent</th>
                                <th>Phase</th>
                                <th>Model</th>
                                <th>Snippet</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for m in r.reviewers %}
                            <tr>
                                <td><code>{{ m.agent }}</code></td>
                                <td class="muted">{{ m.phase }}</td>
                                <td class="muted">{{ (m.model_provider or '') }} {{ (m.model_name or '') }}</td>
                                <td class="muted">{{ m.content_preview }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </details>
                {% endif %}
            </div>
            {% endfor %}
            {% else %}
            <p class="muted">No reviews found for this paper.</p>
            {% endif %}
        </section>
    </main>
</body>

</html>
